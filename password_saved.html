`<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Saved Passwords | Key Safe</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
        <style>
            :root {
                --background: #232326;
                --card-bg: #3a3a3e;
                --primary: #2d8cff;
                --primary-hover: #2063bb;
                --text: #fff;
                --muted: #b0b6c4;
                --danger: #ff5757;
                --warn: #ffb627;
                --success: #30cf7b;
                --bar-bg: #3a3a3e;
                --card-radius: 18px;
                --card-padding: 32px 32px;
                --input-padding-x: 16px;
            }
            body {
                margin: 0;
                padding: 0;
                background: var(--background);
                color: var(--text);
                font-family: 'Inter', Arial, sans-serif;
                min-height: 100vh;
            }
            .top-bar {
                width: 100%;
                height: 60px;
                background: var(--bar-bg);
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0 30px;
                box-sizing: border-box;
                position: fixed;
                top: 0;
                left: 0;
                z-index: 100;
            }
            .bar-left {
                font-size: 1.25rem;
                font-weight: bold;
                color: var(--text);
            }
            .bar-menu {
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: flex-end;
                cursor: pointer;
                position: relative;
                z-index: 101;
                background: none;
                border: none;
            }
            .bar-menu-bars, .bar-menu-x {
                width: 28px;
                height: 28px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                position: relative;
            }
            .bar-menu-bars span {
                display: block;
                height: 4px;
                width: 100%;
                background: #fff;
                margin: 3.5px 0;
                border-radius: 2px;
                transition: background 0.3s;
            }
            .bar-menu-x {
                position: absolute;
                top: 0;
                right: 0;
                width: 32px;
                height: 32px;
                display: none;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                background: none;
            }
            .bar-menu-x span {
                position: absolute;
                width: 24px;
                height: 4px;
                top: 50%;
                left: 50%;
                background: #fff;
                border-radius: 2px;
                transition:
                    transform 0.35s cubic-bezier(.55,.06,.68,.19),
                    opacity 0.18s,
                    background 0.2s;
            }
            .bar-menu-x .x1 {
                transform: translate(-50%, -50%) rotate(45deg);
            }
            .bar-menu-x .x2 {
                transform: translate(-50%, -50%) rotate(-45deg);
            }
            .menu-overlay .bar-menu-x {
                display: flex !important;
                position: absolute;
                top: 30px;
                right: 30px;
                z-index: 201;
                background: none;
            }
            .menu-overlay .bar-menu-x:hover span {
                background: var(--primary);
            }
            .menu-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: var(--menu-bg);
                color: #fff;
                z-index: 200;
                display: none;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                opacity: 0;
                pointer-events: none;
                transition: opacity var(--menu-fade);
                background-color: #3a3a3e;
            }
            .menu-overlay.active {
                display: flex;
                pointer-events: all;
                opacity: 1;
                animation: fadeInMenu 0.4s;
            }
            .menu-overlay.closing {
                opacity: 0;
                pointer-events: none;
                animation: fadeOutMenu 0.35s cubic-bezier(.55,.06,.68,.19);
            }
            @keyframes fadeInMenu {
                from { opacity: 0;}
                to { opacity: 1;}
            }
            @keyframes fadeOutMenu {
                from { opacity: 1;}
                to { opacity: 0;}
            }
            .menu-list {
                width: 90%;
                max-width: 350px;
                display: flex;
                flex-direction: column;
                gap: 22px;
            }
            .menu-item-card, .menu-item-card-logout {
                background: #232326;
                color: #fff;
                border-radius: 12px;
                padding: 0;
                box-shadow: 0 4px 14px #0003;
                transition: background 0.2s, color 0.2s, box-shadow 0.2s;
                cursor: pointer;
                border: none;
                outline: none;
            }
            .menu-item {
                font-size: 1.3rem;
                padding: 24px 0;
                text-align: center;
                color: #fff;
                border: none;
                border-radius: 12px;
                background: none;
                transition: color 0.2s;
                font-family: 'Inter', Arial, sans-serif;
            }
            .menu-item-card:hover, .menu-item-card:focus-within {
                box-shadow: 0 4px 20px #2d8cff55, 0 2px 8px #0005;
            }
            .menu-item-card:hover .menu-item, .menu-item-card:focus-within .menu-item {
                color: var(--primary);
                background: none;
            }
            .menu-item-card-logout:hover, .menu-item-card-logout:focus-within {
                background: var(--danger) !important;
                box-shadow: 0 4px 20px #ff575733, 0 2px 8px #0005;
            }
            .menu-item-card-logout:hover .menu-item, .menu-item-card-logout:focus-within .menu-item {
                color: #fff !important;
            }

            @media (max-width: 600px) {
                .top-bar {
                    padding: 0 12px;
                }
                .menu-list {
                    max-width: 99vw;
                    width: 99vw;
                    border-radius: 0;
                    margin-top: 62px;
                }
            }

            .saved-container {
                margin-top: 80px;
                padding: 32px 10vw 32px 10vw;
                box-sizing: border-box;
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .saved-row {
                display: flex;
                flex-direction: row;
                gap: 32px;
                flex-wrap: wrap;
                justify-content: center;
                width: 100%;
            }
            .saved-card {
                background: var(--card-bg);
                border-radius: var(--card-radius);
                box-shadow: 0 4px 24px #0007;
                padding: var(--card-padding);
                min-width: 260px;
                max-width: 320px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 16px;
                cursor: pointer;
                transition: box-shadow 0.2s, background 0.2s;
                position: relative;
                margin: 0;
            }
            .saved-card:hover {
                background: #252a34;
                box-shadow: 0 8px 24px #2d8cff55, 0 2px 8px #0005;
            }
            .saved-plus {
                font-size: 2.6rem;
                font-weight: 700;
                color: var(--primary);
                user-select: none;
            }
            .saved-label {
                color: var(--muted);
                font-size: 1.08rem;
                font-weight: 600;
                text-align: center;
            }
            .saved-details {
                font-size: 1.07rem;
                color: var(--text);
                text-align: center;
                word-break: break-all;
                margin-bottom: 2px;
            }
            .saved-website {
                font-size: 1.19rem;
                font-weight: 700;
                color: var(--primary);
            }
            .saved-username {
                font-size: 1.08rem;
                color: var(--muted);
            }
            .popup-bg {
                position: fixed;
                top: 0; left: 0; width: 100vw; height: 100vh;
                background: #18181b88;
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 302;
            }
            .popup-bg.active {
                display: flex;
            }
            .popup-card {
                background: var(--card-bg);
                border-radius: 18px;
                box-shadow: 0 6px 32px #000a;
                padding: 38px 36px 28px 36px;
                width: 350px;
                max-width: 96vw;
                display: flex;
                flex-direction: column;
                gap: 18px;
                position: relative;
            }
            .popup-title {
                font-size: 1.22rem;
                font-weight: bold;
                margin-bottom: 8px;
                color: var(--primary);
                text-align: center;
            }
            .popup-form-group {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }
            .popup-form-group label {
                font-size: 1rem;
                color: var(--text);
                font-weight: 500;
            }
            .popup-form-group input {
                width: 100%;
                padding: 10px 16px;
                border-radius: 8px;
                border: 1.5px solid #44444b;
                background: #232326;
                color: var(--text);
                font-family: 'Inter', Arial, sans-serif;
                font-size: 1rem;
                margin-bottom: 0;
                transition: border-color 0.2s;
                box-sizing: border-box;
            }
            .popup-form-group input:focus {
                border-color: var(--primary);
                outline: none;
            }
            .popup-btn-row {
                display: flex;
                flex-direction: row;
                gap: 18px;
                justify-content: center;
                margin-top: 8px;
            }
            .popup-btn {
                background: var(--primary);
                color: #fff;
                border: none;
                border-radius: 8px;
                padding: 10px 26px;
                font-size: 1.08rem;
                font-weight: 600;
                cursor: pointer;
                transition: background 0.2s;
            }
            .popup-btn:hover {
                background: var(--primary-hover);
            }
            .popup-btn.cancel {
                background: #232326;
                color: var(--muted);
                border: 1.5px solid #44444b;
                padding: 10px 22px;
            }
            .popup-btn.cancel:hover {
                background: #252a34;
                color: var(--primary);
            }
            .popup-close {
                position: absolute;
                top: 14px;
                right: 15px;
                font-size: 1.6rem;
                color: var(--muted);
                cursor: pointer;
                background: none;
                border: none;
                border-radius: 10px;
                transition: color 0.2s;
            }
            .popup-close:hover {
                color: var(--danger);
            }
            .popup-error {
                color: var(--danger);
                font-size: 1.01em;
                text-align: center;
                font-weight: 600;
            }
            .password-unlock-bg {
                position: fixed;
                top: 0; left: 0; width: 100vw; height: 100vh;
                background: #18181bbf;
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 303;
            }
            .password-unlock-bg.active {
                display: flex;
            }
            .password-unlock-card {
                background: var(--card-bg);
                border-radius: 18px;
                box-shadow: 0 6px 32px #000a;
                padding: 32px 28px 22px 28px;
                width: 320px;
                max-width: 95vw;
                display: flex;
                flex-direction: column;
                gap: 16px;
                align-items: center;
                position: relative;
            }
            .password-unlock-title {
                font-size: 1.13rem;
                font-weight: bold;
                color: var(--primary);
                text-align: center;
            }
            .password-unlock-form-group {
                display: flex;
                flex-direction: column;
                gap: 8px;
                width: 100%;
            }
            .password-unlock-form-group label {
                font-size: 1rem;
                color: var(--text);
                font-weight: 500;
            }
            .password-unlock-form-group input {
                width: 100%;
                padding: 9px 14px;
                border-radius: 8px;
                border: 1.5px solid #44444b;
                background: #232326;
                color: var(--text);
                font-family: 'Inter', Arial, sans-serif;
                font-size: 1rem;
                transition: border-color 0.2s;
                box-sizing: border-box;
            }
            .password-unlock-form-group input:focus {
                border-color: var(--primary);
                outline: none;
            }
            .password-unlock-btn-row {
                display: flex;
                flex-direction: row;
                gap: 14px;
                justify-content: center;
                margin-top: 8px;
            }
            .password-unlock-btn {
                background: var(--primary);
                color: #fff;
                border: none;
                border-radius: 8px;
                padding: 9px 19px;
                font-size: 1.05rem;
                font-weight: 600;
                cursor: pointer;
                transition: background 0.2s;
            }
            .password-unlock-btn:hover {
                background: var(--primary-hover);
            }
            .password-unlock-btn.cancel {
                background: #232326;
                color: var(--muted);
                border: 1.5px solid #44444b;
                padding: 9px 18px;
            }
            .password-unlock-btn.cancel:hover {
                background: #252a34;
                color: var(--primary);
            }
            .password-unlock-error {
                color: var(--danger);
                font-size: 1.01em;
                text-align: center;
                font-weight: 600;
            }
            .password-details-row {
                display: flex;
                flex-direction: column;
                gap: 13px;
                align-items: flex-start;
                margin-top: 10px;
            }
            .password-details-label {
                font-size: 1.08em;
                color: var(--muted);
                font-weight: 600;
            }
            .password-details-value {
                font-size: 1.13em;
                color: var(--text);
                font-family: 'Inter', monospace;
                letter-spacing: 0.04em;
                background: #232326;
                padding: 8px 12px;
                border-radius: 8px;
                word-break: break-all;
            }
            .password-details-link {
                font-size: 1.13em;
                color: var(--primary);
                text-decoration: underline;
                font-family: 'Inter', monospace;
                background: #232326;
                padding: 8px 12px;
                border-radius: 8px;
                word-break: break-all;
                cursor: pointer;
                transition: color 0.15s;
            }
            .password-details-link:hover {
                color: var(--primary-hover);
            }
            @media (max-width: 1200px) {
                .saved-container {
                    padding: 32px 3vw;
                }
                .saved-row {
                    gap: 22px;
                }
            }
            @media (max-width: 900px) {
                .saved-row {
                    gap: 14px;
                }
                .saved-card {
                    padding: 20px 8px;
                    min-width: 180px;
                    max-width: 220px;
                }
            }
            .app-unlock-bg {
                position: fixed;
                top: 0; left: 0; width: 100vw; height: 100vh;
                background: #18181bbf;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 400;
            }
            .app-unlock-card {
                background: var(--card-bg);
                border-radius: 18px;
                box-shadow: 0 6px 32px #000a;
                padding: 38px 36px 28px 36px;
                width: 350px;
                max-width: 96vw;
                display: flex;
                flex-direction: column;
                gap: 18px;
                position: relative;
                align-items: center;
            }
            .app-unlock-title {
                font-size: 1.22rem;
                font-weight: bold;
                margin-bottom: 8px;
                color: var(--primary);
                text-align: center;
            }
            .app-unlock-form-group {
                display: flex;
                flex-direction: column;
                gap: 15px;
                width: 100%;
            }
            .app-unlock-form-group label {
                font-size: 1rem;
                color: var(--text);
                font-weight: 500;
            }
            .app-unlock-form-group input {
                width: 100%;
                padding: 10px 16px;
                border-radius: 8px;
                border: 1.5px solid #44444b;
                background: #232326;
                color: var(--text);
                font-family: 'Inter', Arial, sans-serif;
                font-size: 1rem;
                margin-bottom: 0;
                transition: border-color 0.2s;
                box-sizing: border-box;
            }
            .app-unlock-form-group input:focus {
                border-color: var(--primary);
                outline: none;
            }
            .app-unlock-btn-row {
                display: flex;
                flex-direction: row;
                gap: 18px;
                justify-content: center;
                margin-top: 8px;
            }
            .app-unlock-btn {
                background: var(--primary);
                color: #fff;
                border: none;
                border-radius: 8px;
                padding: 10px 26px;
                font-size: 1.08rem;
                font-weight: 600;
                cursor: pointer;
                transition: background 0.2s;
            }
            .app-unlock-btn:hover {
                background: var(--primary-hover);
            }
            .app-unlock-error {
                color: var(--danger);
                font-size: 1.01em;
                text-align: center;
                font-weight: 600;
            }

            @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(32px) scale(0.96);}
            to   { opacity: 1; transform: translateY(0) scale(1);}
            }

            @keyframes fadeInZoom {
            from { opacity: 0; transform: scale(0.95);}
            to   { opacity: 1; transform: scale(1);}
            }

            @keyframes fadeOut {
            from { opacity: 1;}
            to   { opacity: 0;}
            }

            .card, .menu-item-card, .generate-btn, .alternate-password, .back-btn {
            transition: transform 0.22s cubic-bezier(.55,.06,.68,.19), box-shadow 0.22s;
            }
            .card:hover, .menu-item-card:hover, .generate-btn:hover, .alternate-password:hover, .back-btn:hover {
            transform: scale(1.04);
            box-shadow: 0 8px 32px #2d8cff33, 0 2px 12px #0003;
            }

            .menu-overlay {
            animation: fadeInZoom 0.5s cubic-bezier(.55,.06,.68,.19);
            }
            .menu-overlay.closing {
            animation: fadeOut 0.32s cubic-bezier(.55,.06,.68,.19);
            }

            .password-output, .suggestion, .faq-card, .alternate-password {
            animation: fadeInUp 0.6s cubic-bezier(.55,.06,.68,.19);
            }

            .faq-card:nth-child(1) { animation-delay: 0.04s; }
            .faq-card:nth-child(2) { animation-delay: 0.08s; }
            .faq-card:nth-child(3) { animation-delay: 0.12s; }

            .strength-bar {
            transition: width 0.33s cubic-bezier(.55,.06,.68,.19), background 0.2s;
            }

            .top-bar {
            animation: fadeInZoom 0.5s cubic-bezier(.55,.06,.68,.19);
            }

            .generate-btn:active, .back-btn:active {
            transform: scale(0.97);
            }

            .copied-badge {
            animation: fadeInZoom 0.3s;
            }
        </style>
    </head>
    <body>
        <div class="top-bar">
            <div class="bar-left" id="barLeft">Saved Passwords</div>
            <button class="bar-menu" id="barMenuBtn" title="Open menu" aria-label="Menu">
                <div class="bar-menu-bars" id="menuBars" style="display:flex">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
        </div>
        <div class="menu-overlay" id="menuOverlay">
            <div class="bar-menu-x" id="menuX" style="display:flex">
                <span class="x1"></span>
                <span class="x2"></span>
            </div>
            <div class="menu-list">
                <div class="menu-item-card home" id="menuHome">
                    <div class="menu-item">Home</div>
                </div>
                <div class="menu-item-card"><div class="menu-item" id="menuPasswordMaker">Password Maker</div></div>
                <div class="menu-item-card"><div class="menu-item" id="menuPasswordChecker">Password Security Checker</div></div>
                <div class="menu-item-card"><div class="menu-item" id="menuSavedPasswords">Saved Passwords</div></div>
                <div class="menu-item-card"><div class="menu-item" id="menuFAQ">FAQ</div></div>
                <div class="menu-item-card"><div class="menu-item" id="menuAbout">About</div></div>
                <div class="menu-item-card-logout"><div class="menu-item" id="menuLogout" tabindex="0" role="button" aria-label="Log Out">Log Out</div></div>
            </div>
        </div>
        <div class="saved-container">
            <div class="saved-row" id="savedRow">
            </div>
        </div>
        <div class="popup-bg" id="addPopup">
            <div class="popup-card">
                <button class="popup-close" id="closeAddPopup" title="Close">&times;</button>
                <div class="popup-title">Add New Password</div>
                <form id="addPasswordForm" autocomplete="off">
                    <div class="popup-form-group">
                        <label for="inputWebsite">Website</label>
                        <input type="text" id="inputWebsite" required maxlength="64" autocomplete="off">
                    </div>
                    <div class="popup-form-group">
                        <label for="inputUsername">Username</label>
                        <input type="text" id="inputUsername" required maxlength="64" autocomplete="off">
                    </div>
                    <div class="popup-form-group">
                        <label for="inputPassword">Password for Website</label>
                        <input type="password" id="inputPassword" required maxlength="64" autocomplete="off">
                    </div>
                    <div class="popup-error" id="addPopupError"></div>
                    <div class="popup-btn-row">
                        <button type="submit" class="popup-btn">Done</button>
                        <button type="button" class="popup-btn cancel" id="cancelAddPopup">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="password-unlock-bg" id="unlockPopup">
            <div class="password-unlock-card">
                <button class="popup-close" id="closeUnlockPopup" title="Close">&times;</button>
                <div class="password-unlock-title">Enter your Key Safe password to view details</div>
                <form id="unlockPasswordForm" autocomplete="off">
                    <div class="password-unlock-form-group">
                        <label for="unlockAppPassword">Key Safe Password</label>
                        <input type="password" id="unlockAppPassword" required maxlength="64" autocomplete="off">
                    </div>
                    <div class="password-unlock-error" id="unlockPopupError"></div>
                    <div class="password-unlock-btn-row">
                        <button type="submit" class="password-unlock-btn">Unlock</button>
                        <button type="button" class="password-unlock-btn cancel" id="cancelUnlockPopup">Cancel</button>
                    </div>
                </form>
                <div id="passwordDetails" style="display:none;">
                    <div class="password-details-row">
                        <div class="password-details-label">Website</div>
                        <a class="password-details-link" id="detailsWebsite" target="_blank"></a>
                        <div class="password-details-label">Username</div>
                        <div class="password-details-value" id="detailsUsername"></div>
                        <div class="password-details-label">Password</div>
                        <div class="password-details-value" id="detailsPassword"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="app-unlock-bg" id="appUnlockBg" style="display:none;">
            <div class="app-unlock-card">
                <div class="app-unlock-title">Unlock Saved Passwords</div>
                <form id="appUnlockForm" autocomplete="off">
                    <div class="app-unlock-form-group">
                        <label for="appUnlockPassword">Enter your Key Safe password</label>
                        <input type="password" id="appUnlockPassword" required maxlength="64" autocomplete="off">
                    </div>
                    <div class="app-unlock-error" id="appUnlockError"></div>
                    <div class="app-unlock-btn-row">
                        <button type="submit" class="app-unlock-btn">Unlock</button>
                    </div>
                </form>
            </div>
        </div>
        
    <script>
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days*24*60*60*1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + encodeURIComponent(value || "") + expires + "; path=/";
        }
        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i=0;i < ca.length;i++) {
                let c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0) return decodeURIComponent(c.substring(nameEQ.length,c.length));
            }
            return null;
        }
        function eraseCookie(name) {   
            document.cookie = name+'=; Max-Age=-99999999; path=/';  
        }

        function getCurrentUser() {
            return localStorage.getItem("keysafe-logged-in");
        }
        function getUsers() {
            return JSON.parse(localStorage.getItem("keysafe-users") || "{}");
        }
        function getUserPassword(username) {
            const users = getUsers();
            return users[username]?.password || "";
        }

        if (!getCurrentUser()) {
            window.location.href = "login_signup.html";
        }

        function getAccountPasswordsKey() {
            return "keysafe-saved-passwords-" + getCurrentUser();
        }
        function getSavedPasswords() {
            let arr = [];
            try {
                arr = JSON.parse(localStorage.getItem(getAccountPasswordsKey()) || "[]");
                if (!Array.isArray(arr)) arr = [];
            } catch (e) { arr = []; }
            return arr;
        }
        function setSavedPasswords(arr) {
            localStorage.setItem(getAccountPasswordsKey(), JSON.stringify(arr));
        }

        function renderSavedCards() {
            const savedRow = document.getElementById("savedRow");
            savedRow.innerHTML = "";
            let saved = getSavedPasswords();
            const plusDiv = document.createElement("div");
            plusDiv.className = "saved-card";
            plusDiv.id = "addSavedCard";
            plusDiv.innerHTML = `<div class="saved-plus">+</div><div class="saved-label">Add Password</div>`;
            plusDiv.onclick = function() {
                showAddPopup();
            };
            savedRow.appendChild(plusDiv);
            saved.forEach((item, idx) => {
                const card = document.createElement("div");
                card.className = "saved-card";
                card.innerHTML = `
                    <div class="saved-website">${item.website}</div>
                    <div class="saved-username">${item.username}</div>
                    <div class="saved-label">Click to view</div>
                    <button class="popup-btn" style="background:var(--danger);margin-top:10px;" onclick="event.stopPropagation(); showDeletePopup(${idx});">Delete</button>
                `;
                card.onclick = function() {
                    showUnlockPopup(idx);
                };
                savedRow.appendChild(card);
            });
        }

        const addPopup = document.getElementById("addPopup");
        function showAddPopup() {
            addPopup.classList.add("active");
            document.getElementById("inputWebsite").value = "";
            document.getElementById("inputUsername").value = "";
            document.getElementById("inputPassword").value = "";
            document.getElementById("addPopupError").textContent = "";
        }
        function hideAddPopup() {
            addPopup.classList.remove("active");
        }
        document.getElementById("closeAddPopup").onclick = hideAddPopup;
        document.getElementById("cancelAddPopup").onclick = hideAddPopup;
        addPopup.onclick = function(e) {
            if (e.target === addPopup) hideAddPopup();
        };

        document.getElementById("addPasswordForm").onsubmit = function(e) {
            e.preventDefault();
            let website = document.getElementById("inputWebsite").value.trim();
            let username = document.getElementById("inputUsername").value.trim();
            let password = document.getElementById("inputPassword").value;
            if (!website || !username || !password) {
                document.getElementById("addPopupError").textContent = "All fields are required.";
                return;
            }
            let safePW = prompt("Enter your account password to save this password:");
            if (safePW !== getUserPassword(getCurrentUser())) {
                document.getElementById("addPopupError").textContent = "Incorrect account password.";
                return;
            }
            let arr = getSavedPasswords();
            arr.push({website, username, password});
            setSavedPasswords(arr);
            hideAddPopup();
            renderSavedCards();
        };

        const unlockPopup = document.getElementById("unlockPopup");
        let unlockIdx = null;
        function showUnlockPopup(idx) {
            unlockPopup.classList.add("active");
            unlockIdx = idx;
            document.getElementById("unlockAppPassword").value = "";
            document.getElementById("unlockPopupError").textContent = "";
            document.getElementById("passwordDetails").style.display = "none";
            document.getElementById("unlockPasswordForm").style.display = "block";
        }
        function hideUnlockPopup() {
            unlockPopup.classList.remove("active");
            unlockIdx = null;
            resetUnlockPopup();
        }
        document.getElementById("closeUnlockPopup").onclick = hideUnlockPopup;
        document.getElementById("cancelUnlockPopup").onclick = hideUnlockPopup;
        unlockPopup.onclick = function(e) {
            if (e.target === unlockPopup) hideUnlockPopup();
        };
        document.getElementById("unlockPasswordForm").onsubmit = function(e) {
            e.preventDefault();
            let arr = getSavedPasswords();
            if (unlockIdx == null || !arr[unlockIdx]) return;
            let inputAppPw = document.getElementById("unlockAppPassword").value;
            if (inputAppPw !== getUserPassword(getCurrentUser())) {
                document.getElementById("unlockPopupError").textContent = "Incorrect account password.";
                return;
            }

            let site = arr[unlockIdx].website;
            let url = site;
            if (!/^https?:\/\//i.test(site)) url = "https://" + site;
            document.getElementById("detailsWebsite").textContent = site;
            document.getElementById("detailsWebsite").setAttribute("href", url);
            document.getElementById("detailsUsername").textContent = arr[unlockIdx].username;
            document.getElementById("detailsPassword").textContent = arr[unlockIdx].password;
            document.getElementById("passwordDetails").style.display = "block";
            document.getElementById("unlockPasswordForm").style.display = "none";
        };

        function resetUnlockPopup() {
            document.getElementById("passwordDetails").style.display = "none";
            document.getElementById("unlockPasswordForm").style.display = "block";
            document.getElementById("unlockAppPassword").value = "";
            document.getElementById("unlockPopupError").textContent = "";
        }
        document.getElementById("closeUnlockPopup").onclick = function(){
            hideUnlockPopup(); resetUnlockPopup();
        };
        document.getElementById("cancelUnlockPopup").onclick = function(){
            hideUnlockPopup(); resetUnlockPopup();
        };
        unlockPopup.onclick = function(e) {
            if (e.target === unlockPopup) { hideUnlockPopup(); resetUnlockPopup();}
        };

        function showDeletePopup(idx) {
            setTimeout(function() {
                let arr = getSavedPasswords();
                if (!arr[idx]) return;
                let confirmDelete = confirm("Are you sure you want to delete this password?");
                if (!confirmDelete) return;
                let safePW = prompt("Enter your account password to delete this password:");
                if (safePW !== getUserPassword(getCurrentUser())) {
                    alert("Incorrect account password. Password NOT deleted.");
                    return;
                }
                arr.splice(idx, 1);
                setSavedPasswords(arr);
                renderSavedCards();
            }, 100);
        }
        window.showDeletePopup = showDeletePopup;

        renderSavedCards();

        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                hideAddPopup();
                hideUnlockPopup();
            }
        });
        window.addEventListener("beforeunload", function() {
            hideAddPopup();
            hideUnlockPopup();
        });

        const menuBtn = document.getElementById("barMenuBtn");
            const menuOverlay = document.getElementById("menuOverlay");
            const menuBars = document.getElementById("menuBars");
            const menuX = document.getElementById("menuX");
            let menuOpen = false;
            let menuCloseTimeout = null;
            menuBtn.onclick = function(e) {
                e.stopPropagation();
                if (!menuOpen) {
                    menuOverlay.classList.add("active");
                    menuOverlay.classList.remove("closing");
                    menuBars.style.display = "none";
                    menuOpen = true;
                }
            };
            menuX.onclick = function(e) {
                e.stopPropagation();
                if (menuOpen) {
                    menuOverlay.classList.remove("active");
                    menuOverlay.classList.add("closing");
                    menuBars.style.display = "flex";
                    menuOpen = false;
                    clearTimeout(menuCloseTimeout);
                    menuCloseTimeout = setTimeout(() => {
                        menuOverlay.classList.remove("closing");
                    }, 350);
                }
            };
            menuOverlay.onclick = function(e) {
                if(e.target === menuOverlay && menuOpen) {
                    menuX.onclick(e);
                }
            };
            function closeMenu() {
                if (menuOpen) {
                    menuX.onclick(new Event("click"));
                }
            }

            document.getElementById("menuHome").onclick = function() {
                closeMenu();
                window.location.href = "index.html";
            };

            document.getElementById("menuPasswordMaker").onclick = function() {
                closeMenu();
                window.location.href = "password_maker.html";
            };
            document.getElementById("menuPasswordChecker").onclick = function() {
                closeMenu();
                window.location.href = "password_checker.html";
            };
            document.getElementById("menuSavedPasswords").onclick = function() {
                closeMenu();
                window.location.href = "password_saved.html";
            };
            document.getElementById("menuFAQ").onclick = function() {
                closeMenu();
                window.location.href = "faq.html";
            };
            document.getElementById("menuAbout").onclick = function() {
                closeMenu();
                window.open("https://kingfarooq.github.io", "_blank");
            };
            document.getElementById("menuLogout").onclick = function() {
                localStorage.removeItem("keysafe-logged-in");
                localStorage.removeItem("keysafe-app-password");
                window.location.href = "login_signup.html";
            };
        </script>
    </body>
</html>

<!--
    Notes:
    - Stored in browser localStorage
    - Each user has their own vault
    - Multi-layer Authenticatoin for every action
    - Auto-clear
    - Add new passwords
    - View passwords
    - Delete passwords
    - Clean UI
    
    Key Functions:
    - Storage Managment
    - User Authenticaiton
    - Delete Password

-->