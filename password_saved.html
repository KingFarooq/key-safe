<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ========== DOCUMENT METADATA ========== -->
    <meta charset="UTF-8">
    <title>Saved Passwords | Key Safe</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
    <!-- ========== EXTERNAL STYLESHEETS ========== -->
    <!-- Google Fonts: Inter font family -->
    <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   
    <!-- ========== INTERNAL STYLES ========== -->
    <style>
        /* ========== CSS VARIABLES (Custom Properties) ========== */
        /* Centralized color scheme and design tokens for easy maintenance */
        :root {
            --background: #0f172a;          /* Main background color */
            --container-bg: #1e293b;        /* Container background */
            --primary: #3b82f6;             /* Primary blue color */
            --primary-hover: #2563eb;       /* Primary hover state */
            --text: #f8fafc;                /* Main text color */
            --muted: #94a3b8;               /* Secondary/muted text */
            --input-bg: #334155;            /* Input field background */
            --input-border: #475569;        /* Input border color */
            --error: #ef4444;               /* Error/red color */
            --success: #10b981;             /* Success/green color */
            --warning: #f59e0b;             /* Warning/orange color */
            --danger: #ef4444;              /* Danger/red color */
            --box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* Default shadow */
            --gradient: linear-gradient(135deg, #3b82f6, #8b5cf6); /* Button gradient */
        }
       
        /* ========== GLOBAL RESET & BASE STYLES ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box; /* Include padding/border in element dimensions */
        }
       
        body {
            background: var(--background);
            color: var(--text);
            font-family: 'Inter', Arial, sans-serif;
            min-height: 100vh;               /* Full viewport height */
            line-height: 1.6;                /* Better text readability */
        }
       
        /* ========== TOP NAVIGATION BAR ========== */
        .top-bar {
            width: 100%;
            height: 70px;
            background: var(--container-bg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: fixed;                 /* Fixed at top */
            top: 0;
            left: 0;
            z-index: 100;                    /* Above other content */
            box-shadow: 0 2px 20px rgba(0,0,0,0.2);
            animation: slideDown 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); /* Smooth entrance */
        }
       
        /* Animation for top bar sliding down */
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
       
        /* Left side of top bar (title + timer) */
        .bar-left {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 15px;                      /* Space between elements */
        }
       
        /* Session timer display */
        .session-timer {
            font-size: 0.85rem;
            color: var(--muted);
            background: var(--input-bg);
            padding: 4px 10px;
            border-radius: 20px;            /* Pill-shaped */
            font-weight: 500;
        }
       
        /* Timer warning state (5-10 minutes remaining) */
        .session-timer.warning {
            color: var(--warning);
            background: rgba(245, 158, 11, 0.1);
        }
       
        /* Timer danger state (<5 minutes remaining) */
        .session-timer.danger {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }
       
        /* ========== HAMBURGER MENU BUTTON ========== */
        .bar-menu {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            z-index: 101;
            background: var(--input-bg);
            border: none;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
       
        /* Hamburger menu hover effect */
        .bar-menu:hover {
            background: var(--primary);
            transform: scale(1.05);
        }
       
        /* Three-bar icon for hamburger menu */
        .bar-menu-bars {
            width: 24px;
            height: 18px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            transition: all 0.3s ease;
        }
       
        /* Individual bars in hamburger icon */
        .bar-menu-bars span {
            display: block;
            height: 3px;
            width: 100%;
            background: var(--text);
            border-radius: 2px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            transform-origin: center;        /* Rotation origin point */
        }
       
        /* ========== CLOSE (X) BUTTON ========== */
        .bar-menu-x {
            position: absolute;
            top: 0;
            right: 0;
            width: 44px;
            height: 44px;
            display: none;                   /* Hidden by default */
            justify-content: center;
            align-items: center;
            cursor: pointer;
            background: var(--input-bg);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
       
        /* Close button hover effect */
        .bar-menu-x:hover {
            background: var(--primary);
            transform: scale(1.05);
        }
       
        /* X icon lines */
        .bar-menu-x span {
            position: absolute;
            width: 20px;
            height: 3px;
            background: var(--text);
            border-radius: 2px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
       
        /* First X line rotated 45 degrees */
        .bar-menu-x .x1 {
            transform: rotate(45deg);
        }
       
        /* Second X line rotated -45 degrees */
        .bar-menu-x .x2 {
            transform: rotate(-45deg);
        }
       
        /* ========== FULLSCREEN MENU OVERLAY ========== */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--container-bg);
            color: #fff;
            z-index: 200;                    /* Above everything except modals */
            display: none;                   /* Hidden by default */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;            /* Cannot interact when hidden */
            transition: opacity 0.35s;
        }
       
        /* Active state for menu overlay */
        .menu-overlay.active {
            display: flex;
            pointer-events: all;             /* Can interact when active */
            opacity: 1;
            animation: fadeInZoom 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
       
        /* Closing animation state */
        .menu-overlay.closing {
            opacity: 0;
            pointer-events: none;
            animation: fadeOut 0.35s cubic-bezier(.55,.06,.68,.19);
        }
       
        /* Menu entrance animation */
        @keyframes fadeInZoom {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
       
        /* Menu exit animation */
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
       
        /* Menu item list container */
        .menu-list {
            width: 90%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 16px;                      /* Space between menu items */
        }
       
        /* Individual menu item card */
        .menu-item-card {
            background: var(--input-bg);
            color: var(--text);
            border-radius: 16px;
            padding: 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            cursor: pointer;
            border: none;
            outline: none;
            overflow: hidden;
            border: 2px solid transparent;   /* For hover effect */
        }
       
        /* Menu item content */
        .menu-item {
            font-size: 1.1rem;
            padding: 20px 0;
            text-align: center;
            color: var(--text);
            border: none;
            border-radius: 16px;
            background: none;
            transition: all 0.3s;
            font-family: 'Inter', Arial, sans-serif;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;                      /* Space between icon and text */
        }
       
        /* Menu item hover effects */
        .menu-item-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.3);
            border-color: var(--primary);
        }
       
        .menu-item:hover {
            color: var(--primary);
        }
       
        /* Special styling for logout menu item */
        .menu-item-card.logout {
            background: var(--input-bg);
            margin-top: 10px;
        }
       
        .menu-item-card.logout:hover {
            background: var(--danger);
            border-color: var(--danger);
            box-shadow: 0 8px 30px rgba(239, 68, 68, 0.3);
        }
       
        /* ========== MAIN CONTENT AREA ========== */
        .main-content {
            background: var(--background);
            padding-top: 90px;               /* Account for fixed top bar */
            min-height: 100vh;
            min-height: 100svh;              /* Consider mobile viewport height */
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            box-sizing: border-box;
            padding-bottom: 30px;
            animation: fadeInUp 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
       
        /* Main content entrance animation */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
       
        /* ========== DASHBOARD LAYOUT ========== */
        .dashboard {
            width: 90%;
            max-width: 1400px;
            display: flex;
            flex-direction: column;
            gap: 25px;                      /* Space between sections */
        }
       
        /* Individual dashboard sections */
        .dashboard-section {
            background: var(--container-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--box-shadow);
            animation: fadeInUp 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55) both;
        }
       
        /* Staggered animation delays for multiple sections */
        .dashboard-section:nth-child(1) { animation-delay: 0.1s; }
        .dashboard-section:nth-child(2) { animation-delay: 0.2s; }
       
        /* Section title styling */
        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;                      /* Space between icon and text */
        }
       
        .section-title i {
            color: var(--primary);          /* Icon color matches primary */
        }
       
        /* ========== CONTROLS SECTION ========== */
        .controls-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Responsive grid */
            gap: 20px;
            margin-bottom: 25px;
        }
       
        /* Control group (label + input) */
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;                      /* Space between label and input */
        }
       
        /* Search input with icon */
        .search-input {
            padding: 12px 16px;
            border: 2px solid var(--input-border);
            border-radius: 10px;
            background: var(--input-bg);
            color: var(--text);
            font-family: 'Inter', Arial, sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
            width: 100%;
        }
       
        /* Search input focus state */
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); /* Focus ring */
        }
       
        /* Container for search input with positioning context */
        .search-input-container {
            position: relative;
        }
       
        /* Search icon positioned inside input */
        .search-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);    /* Perfect vertical centering */
            color: var(--muted);
        }
       
        /* ========== BULK ACTION BUTTONS ========== */
        .bulk-actions {
            display: flex;
            gap: 15px;                      /* Space between buttons */
            margin-bottom: 20px;
            flex-wrap: wrap;                /* Wrap on smaller screens */
        }
       
        /* Base button styling */
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-family: 'Inter', Arial, sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            display: flex;
            align-items: center;
            gap: 8px;                       /* Space between icon and text */
        }
       
        /* Primary button (gradient background) */
        .btn-primary {
            background: var(--gradient);
            color: white;
        }
       
        .btn-primary:hover {
            transform: translateY(-2px);    /* Lift effect on hover */
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
       
        /* Secondary button (outline style) */
        .btn-secondary {
            background: var(--input-bg);
            color: var(--text);
            border: 2px solid var(--input-border);
        }
       
        /* Danger button (red) */
        .btn-danger {
            background: var(--danger);
            color: white;
        }
       
        /* Success button (green) */
        .btn-success {
            background: var(--success);
            color: white;
        }
       
        /* ========== PASSWORD GRID/CARDS ========== */
        .password-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); /* Responsive grid */
            gap: 20px;
            margin-top: 20px;
        }
       
        /* Individual password card */
        .password-card {
            background: var(--input-bg);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            position: relative;             /* For absolute positioning of children */
            animation: fadeInUp 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
       
        /* Password card hover effects */
        .password-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }
       
        /* Selected state for bulk operations */
        .password-card.selected {
            border-color: var(--primary);
            background: rgba(59, 130, 246, 0.1); /* Semi-transparent blue */
        }
       
        /* Checkbox for selecting passwords */
        .password-checkbox {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 20px;
            height: 20px;
            accent-color: var(--primary);   /* Custom checkbox color */
            cursor: pointer;
        }
       
        /* Password card header (website name) */
        .password-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
       
        /* Website title */
        .password-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            word-break: break-word;         /* Break long website names */
        }
       
        /* Password details container */
        .password-details {
            display: flex;
            flex-direction: column;
            gap: 12px;                      /* Space between detail rows */
            margin-bottom: 15px;
        }
       
        /* Individual detail row (label + value) */
        .detail-row {
            display: flex;
            align-items: center;
            gap: 10px;                      /* Space between label and value */
        }
       
        /* Detail label (Username:, Password:, etc.) */
        .detail-label {
            font-size: 0.9rem;
            color: var(--muted);
            min-width: 80px;                /* Consistent label width */
            font-weight: 600;
        }
       
        /* Detail value (actual data) */
        .detail-value {
            font-size: 1rem;
            color: var(--text);
            word-break: break-all;          /* Break long values like passwords */
        }
       
        /* Container for tags */
        .password-tags {
            display: flex;
            flex-wrap: wrap;                /* Wrap multiple tags */
            gap: 8px;                       /* Space between tags */
            margin-top: 10px;
        }
       
        /* Individual tag pill */
        .tag {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 20px;            /* Pill shape */
            font-size: 0.85rem;
            font-weight: 500;
        }
       
        /* Action buttons container (view, copy, edit) */
        .password-actions {
            display: flex;
            gap: 10px;                      /* Space between action buttons */
            justify-content: flex-end;      /* Align to right */
            margin-top: 15px;
        }
       
        /* Small icon-only buttons */
        .icon-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            background: var(--input-border);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
       
        /* Icon button hover effects */
        .icon-btn:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);          /* Slight scale up on hover */
        }
       
        /* Temporary "Copied!" badge */
        .copy-badge {
            position: absolute;
            top: 10px;
            right: 45px;
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            animation: fadeInZoom 0.3s;
        }
       
        /* Empty state (no passwords) */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--muted);
            grid-column: 1 / -1;            /* Span entire grid width */
        }
       
        /* ========== MODAL DIALOGS ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(15, 23, 42, 0.8); /* Semi-transparent overlay */
            display: none;                  /* Hidden by default */
            align-items: center;
            justify-content: center;
            z-index: 300;                   /* Above everything */
        }
       
        /* Active modal state */
        .modal-overlay.active {
            display: flex;
            animation: fadeInZoom 0.3s;
        }
       
        /* Modal card (actual dialog) */
        .modal-card {
            background: var(--container-bg);
            border-radius: 16px;
            padding: 30px;
            width: 450px;
            max-width: 95vw;                /* Responsive on mobile */
            max-height: 80vh;               /* Don't exceed viewport height */
            overflow-y: auto;               /* Scroll if content is too tall */
            box-shadow: var(--box-shadow);
            animation: fadeInUp 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
       
        /* Modal header (title + close button) */
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
       
        /* Modal title */
        .modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
        }
       
        /* Modal close button (X) */
        .modal-close {
            background: none;
            border: none;
            color: var(--muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }
       
        .modal-close:hover {
            color: var(--danger);           /* Red on hover */
        }
       
        /* ========== FORM STYLING ========== */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 10px;                      /* Space between label and input */
            margin-bottom: 20px;            /* Space between form groups */
        }
       
        /* Form input fields */
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 16px;
            border: 2px solid var(--input-border);
            border-radius: 10px;
            background: var(--input-bg);
            color: var(--text);
            font-family: 'Inter', Arial, sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
        }
       
        /* Form input focus states */
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); /* Focus ring */
        }
       
        /* ========== TAGS INPUT COMPONENT ========== */
        .tags-input-container {
            display: flex;
            flex-wrap: wrap;                /* Wrap tags to multiple lines */
            gap: 8px;                       /* Space between tags */
            padding: 12px;
            border: 2px solid var(--input-border);
            border-radius: 10px;
            background: var(--input-bg);
            min-height: 50px;
            align-items: center;
        }
       
        /* Individual tag item in the input */
        .tag-item {
            background: rgba(59, 130, 246, 0.2);
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 20px;            /* Pill shape */
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;                       /* Space between text and remove button */
        }
       
        /* Remove (X) button on tags */
        .tag-remove {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;             /* Circular remove button */
        }
       
        .tag-remove:hover {
            background: var(--primary);
            color: white;
        }
       
        /* Input field inside tags container */
        .tags-input {
            border: none;
            background: none;
            color: var(--text);
            font-family: 'Inter', Arial, sans-serif;
            font-size: 1rem;
            flex: 1;                        /* Take remaining space */
            min-width: 100px;               /* Minimum width for typing */
            outline: none;
        }
       
        /* ========== STATISTICS CARDS ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Responsive */
            gap: 20px;
            margin-top: 20px;
        }
       
        /* Individual stat card */
        .stat-card {
            background: var(--input-bg);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
        }
       
        .stat-card:hover {
            transform: translateY(-5px);    /* Lift effect on hover */
        }
       
        /* Large stat value (number) */
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--primary);
        }
       
        /* Stat label (description) */
        .stat-label {
            font-size: 0.9rem;
            color: var(--muted);
        }
       
        /* ========== RESPONSIVE DESIGN ========== */
        /* Tablet and smaller screens */
        @media (max-width: 768px) {
            .top-bar {
                padding: 0 20px;
                height: 60px;               /* Smaller on mobile */
            }
           
            .bar-left {
                font-size: 1.1rem;
            }
           
            .main-content {
                padding-top: 80px;          /* Adjust for smaller header */
            }
           
            .dashboard {
                width: 95%;                 /* More width on mobile */
            }
           
            .password-grid {
                grid-template-columns: 1fr; /* Single column on mobile */
            }
           
            .controls-row {
                grid-template-columns: 1fr; /* Stack controls vertically */
            }
           
            .bulk-actions {
                flex-direction: column;     /* Stack buttons vertically */
            }
           
            .password-header {
                flex-direction: column;     /* Stack header elements */
                align-items: flex-start;
                gap: 10px;
            }
        }
       
        /* Mobile phones */
        @media (max-width: 480px) {
            .top-bar {
                padding: 0 15px;
            }
           
            .dashboard-section {
                padding: 15px;              /* Less padding on small screens */
            }
           
            .section-title {
                font-size: 1.2rem;
            }
           
            .modal-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- ========== TOP NAVIGATION ========== -->
    <div class="top-bar">
        <div class="bar-left">
            <span id="barLeft">Saved Passwords</span>
            <div class="session-timer" id="sessionTimer">Session: --</div>
        </div>
        <!-- Hamburger menu button -->
        <button class="bar-menu" id="barMenuBtn" title="Open menu" aria-label="Menu">
            <div class="bar-menu-bars" id="menuBars">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
    </div>
   
    <!-- ========== FULLSCREEN MENU OVERLAY ========== -->
    <div class="menu-overlay" id="menuOverlay">
        <div class="bar-menu-x" id="menuX">
            <span class="x1"></span>
            <span class="x2"></span>
        </div>
        <div class="menu-list">
            <!-- Navigation menu items -->
            <div class="menu-item-card"><div class="menu-item" id="menuHome"><i class="fas fa-home"></i> Home</div></div>
            <div class="menu-item-card"><div class="menu-item" id="menuPasswordMaker"><i class="fas fa-key"></i> Password Maker</div></div>
            <div class="menu-item-card"><div class="menu-item" id="menuPasswordChecker"><i class="fas fa-shield-alt"></i> Password Security Checker</div></div>
            <div class="menu-item-card"><div class="menu-item" id="menuSavedPasswords"><i class="fas fa-save"></i> Saved Passwords</div></div>
            <div class="menu-item-card"><div class="menu-item" id="menuFAQ"><i class="fas fa-question-circle"></i> FAQ</div></div>
            <div class="menu-item-card"><div class="menu-item" id="menuAbout"><i class="fas fa-info-circle"></i> About</div></div>
            <!-- Logout button with different styling -->
            <div class="menu-item-card logout"><div class="menu-item" id="menuLogout"><i class="fas fa-sign-out-alt"></i> Log Out</div></div>
        </div>
    </div>
   
    <!-- ========== MAIN CONTENT AREA ========== -->
    <div class="main-content">
        <div class="dashboard">
            <!-- ========== CONTROLS SECTION ========== -->
            <div class="dashboard-section">
                <h2 class="section-title"><i class="fas fa-sliders-h"></i> Password Management</h2>
               
                <!-- Search and filter controls -->
                <div class="controls-row">
                    <div class="control-group">
                        <label for="searchInput"><i class="fas fa-search"></i> Search Passwords</label>
                        <div class="search-input-container">
                            <input type="text" class="search-input" id="searchInput" placeholder="Search by website, username, or tags...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                   
                    <div class="control-group">
                        <label for="tagFilter"><i class="fas fa-tags"></i> Filter by Tag</label>
                        <select class="select-input" id="tagFilter">
                            <option value="all">All Tags</option>
                            <!-- Tags will be populated dynamically by JavaScript -->
                        </select>
                    </div>
                </div>
               
                <!-- Bulk action buttons -->
                <div class="bulk-actions">
                    <button class="btn btn-primary" id="addPasswordBtn">
                        <i class="fas fa-plus"></i>
                        Add Password
                    </button>
                    <button class="btn btn-secondary" id="selectAllBtn">
                        <i class="fas fa-check-square"></i>
                        Select All
                    </button>
                    <button class="btn btn-danger" id="deleteSelectedBtn">
                        <i class="fas fa-trash"></i>
                        Delete Selected
                    </button>
                    <button class="btn btn-success" id="downloadAllBtn">
                        <i class="fas fa-download"></i>
                        Download All
                    </button>
                </div>
               
                <!-- Statistics display -->
                <div class="stats-grid" id="passwordStats">
                    <!-- Statistics will be populated dynamically by JavaScript -->
                </div>
            </div>
           
            <!-- ========== PASSWORDS GRID SECTION ========== -->
            <div class="dashboard-section">
                <h2 class="section-title"><i class="fas fa-key"></i> Your Passwords</h2>
                <div class="password-grid" id="passwordGrid">
                    <!-- Password cards will be populated dynamically by JavaScript -->
                    <!-- Empty state shown when no passwords exist -->
                    <div class="empty-state">
                        <i class="fas fa-key"></i>
                        <p>No passwords saved yet. Click "Add Password" to get started!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
   
    <!-- ========== MODAL DIALOGS ========== -->
    <!-- Add/Edit Password Modal -->
    <div class="modal-overlay" id="passwordModal">
        <div class="modal-card">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Add New Password</div>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <form id="passwordForm" autocomplete="off">
                <div class="form-group">
                    <label for="modalWebsite">Website/Service</label>
                    <input type="text" id="modalWebsite" required maxlength="64" autocomplete="off" placeholder="example.com">
                </div>
               
                <div class="form-group">
                    <label for="modalUsername">Username/Email</label>
                    <input type="text" id="modalUsername" required maxlength="64" autocomplete="off" placeholder="user@example.com">
                </div>
               
                <div class="form-group">
                    <label for="modalPassword">Password</label>
                    <input type="password" id="modalPassword" required maxlength="64" autocomplete="off">
                </div>
               
                <div class="form-group">
                    <label for="modalTags">Tags (comma separated)</label>
                    <div class="tags-input-container" id="tagsContainer">
                        <!-- Tags will be added here dynamically -->
                        <input type="text" id="modalTags" class="tags-input" placeholder="Type tags and press Enter...">
                    </div>
                </div>
               
                <div class="form-group">
                    <label for="modalNotes">Notes (Optional)</label>
                    <textarea id="modalNotes" rows="3" placeholder="Add any additional notes..."></textarea>
                </div>
               
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="modalSubmitBtn">Save Password</button>
                    <button type="button" class="btn btn-secondary" id="modalCancelBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>
   
    <!-- Unlock Password Modal (to view password) -->
    <div class="modal-overlay" id="unlockModal">
        <div class="modal-card">
            <div class="modal-header">
                <div class="modal-title">Unlock Password</div>
                <button class="modal-close" id="closeUnlockModal">&times;</button>
            </div>
            <form id="unlockForm" autocomplete="off">
                <div class="form-group">
                    <label for="unlockPassword">Enter your master password</label>
                    <input type="password" id="unlockPassword" required autocomplete="off">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Unlock</button>
                    <button type="button" class="btn btn-secondary" id="cancelUnlockBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Master Password Verification Modal (for sensitive operations) -->
    <div class="modal-overlay" id="masterPasswordModal">
        <div class="modal-card">
            <div class="modal-header">
                <div class="modal-title">Verify Master Password</div>
                <button class="modal-close" id="closeMasterPasswordModal">&times;</button>
            </div>
            <form id="masterPasswordForm" autocomplete="off">
                <div class="form-group">
                    <label for="masterPasswordInput">Enter your master password to continue</label>
                    <input type="password" id="masterPasswordInput" required autocomplete="off">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Verify</button>
                    <button type="button" class="btn btn-secondary" id="cancelMasterPasswordBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>
   
    <!-- ========== JAVASCRIPT ========== -->
    <script>
        // ========== SESSION MANAGEMENT ==========
        /**
         * Get the currently logged-in user from localStorage
         * Checks if session is still valid based on timeout
         * @returns {Object|null} User session data or null if not logged in/expired
         */
        function getLoggedInUser() {
            const sessionData = localStorage.getItem("keysafe-logged-in");
            if (!sessionData) return null;
           
            try {
                const data = JSON.parse(sessionData);
                const now = Date.now();
                // Determine session timeout based on "remember me" setting
                const SESSION_TIMEOUT = data.rememberMe ?
                    30 * 24 * 60 * 60 * 1000 : // 30 days for "remember me"
                    30 * 60 * 1000; // 30 minutes for regular session
               
                // Check if session has expired
                if (now - data.loginTime > SESSION_TIMEOUT) {
                    clearLoggedInUser();
                    return null;
                }
               
                return data;
            } catch (e) {
                console.error("Error parsing session data:", e);
                clearLoggedInUser();
                return null;
            }
        }

        /**
         * Clear the logged-in user session
         */
        function clearLoggedInUser() {
            localStorage.removeItem("keysafe-logged-in");
        }

        /**
         * Update the session timer display in the top bar
         * Shows time remaining and changes color based on remaining time
         */
        function updateSessionTimer() {
            const sessionData = getLoggedInUser();
            const timerElement = document.getElementById("sessionTimer");
           
            if (!sessionData) {
                timerElement.textContent = "Session: --";
                timerElement.className = "session-timer";
                // Redirect to login if session expired
                setTimeout(() => {
                    window.location.href = "login_signup.html";
                }, 100);
                return;
            }
           
            const now = Date.now();
            const SESSION_TIMEOUT = sessionData.rememberMe ?
                30 * 24 * 60 * 60 * 1000 : // 30 days
                30 * 60 * 1000; // 30 minutes
           
            const timeRemaining = SESSION_TIMEOUT - (now - sessionData.loginTime);
           
            // If time is up, logout and redirect
            if (timeRemaining <= 0) {
                clearLoggedInUser();
                window.location.href = "login_signup.html";
                return;
            }
           
            // Calculate minutes and seconds remaining
            const minutes = Math.floor(timeRemaining / 60000);
            const seconds = Math.floor((timeRemaining % 60000) / 1000);
           
            let timerText;
            if (sessionData.rememberMe) {
                // Display in days/hours for "remember me" sessions
                if (minutes > 1440) {
                    const days = Math.floor(minutes / 1440);
                    timerText = `Session: ${days}d`;
                } else if (minutes > 60) {
                    const hours = Math.floor(minutes / 60);
                    timerText = `Session: ${hours}h`;
                } else {
                    timerText = `Session: ${minutes}m`;
                }
            } else {
                // Display in MM:SS for regular sessions
                timerText = `Session: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
           
            timerElement.textContent = timerText;
            timerElement.className = "session-timer";
           
            // Add warning/danger classes based on time remaining
            if (!sessionData.rememberMe) {
                if (minutes < 5) {
                    timerElement.classList.add("danger");      // Red: <5 minutes
                } else if (minutes < 10) {
                    timerElement.classList.add("warning");     // Orange: 5-10 minutes
                }
            }
        }

        // ========== PASSWORD STORAGE FUNCTIONS ==========
        /**
         * Get the localStorage key for the current user's passwords
         * Uses username to create unique key per user
         * @returns {string} localStorage key
         */
        function getAccountPasswordsKey() {
            const sessionData = getLoggedInUser();
            const username = sessionData ? sessionData.username : 'default';
            return "keysafe-saved-passwords-" + username;
        }

        /**
         * Retrieve saved passwords from localStorage
         * @returns {Array} Array of password objects
         */
        function getSavedPasswords() {
            let arr = [];
            try {
                arr = JSON.parse(localStorage.getItem(getAccountPasswordsKey()) || "[]");
                if (!Array.isArray(arr)) arr = [];
            } catch (e) {
                console.error("Error loading passwords:", e);
                arr = [];
            }
            return arr;
        }

        /**
         * Save passwords array to localStorage
         * @param {Array} arr - Array of password objects to save
         */
        function setSavedPasswords(arr) {
            localStorage.setItem(getAccountPasswordsKey(), JSON.stringify(arr));
        }

        /**
         * Get the master password for the current user
         * @returns {string|null} Master password or null if not found
         */
        function getMasterPassword() {
            const sessionData = getLoggedInUser();
            const username = sessionData ? sessionData.username : null;
            if (!username) return null;
           
            try {
                const users = JSON.parse(localStorage.getItem("keysafe-users") || "{}");
                return users[username]?.password || null;
            } catch (e) {
                console.error("Error getting master password:", e);
                return null;
            }
        }

        // ========== TAG MANAGEMENT ==========
        /**
         * Extract all unique tags from saved passwords
         * @returns {Array} Sorted array of unique tags
         */
        function getAllTags() {
            const passwords = getSavedPasswords();
            const tags = new Set(); // Use Set to ensure uniqueness
            passwords.forEach(pw => {
                if (pw.tags && Array.isArray(pw.tags)) {
                    pw.tags.forEach(tag => {
                        if (tag && tag.trim() !== "") {
                            tags.add(tag.trim());
                        }
                    });
                }
            });
            return Array.from(tags).sort(); // Convert to array and sort
        }

        /**
         * Parse comma-separated tag string into array
         * @param {string} tagString - Comma-separated tags
         * @returns {Array} Array of trimmed tags
         */
        function parseTags(tagString) {
            if (!tagString) return [];
            return tagString.split(',')
                .map(tag => tag.trim())
                .filter(tag => tag !== "");
        }

        // ========== UI RENDERING FUNCTIONS ==========
        /**
         * Render password cards in the grid
         * @param {Array} [filteredPasswords=null] - Optional filtered passwords to display
         */
        function renderPasswordGrid(filteredPasswords = null) {
            const grid = document.getElementById("passwordGrid");
            const passwords = filteredPasswords || getSavedPasswords();
           
            // Show empty state if no passwords
            if (passwords.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-key"></i>
                        <p>No passwords found. Try adjusting your filters or add a new password.</p>
                    </div>
                `;
                return;
            }
           
            grid.innerHTML = ''; // Clear existing cards
           
            // Create a card for each password
            passwords.forEach((password, index) => {
                const card = document.createElement('div');
                card.className = 'password-card';
                card.dataset.index = index; // Store index for later reference
               
                // Create tags HTML if tags exist
                let tagsHtml = '';
                if (password.tags && password.tags.length > 0) {
                    password.tags.forEach(tag => {
                        tagsHtml += `<span class="tag">${tag}</span>`;
                    });
                }
               
                // Build card HTML
                card.innerHTML = `
                    <input type="checkbox" class="password-checkbox" data-index="${index}">
                    <div class="password-header">
                        <div class="password-title">${password.website || 'Unknown Website'}</div>
                    </div>
                    <div class="password-details">
                        <div class="detail-row">
                            <div class="detail-label">Username:</div>
                            <div class="detail-value">${password.username || 'N/A'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Password:</div>
                            <div class="detail-value">••••••••</div> <!-- Masked password -->
                        </div>
                        ${password.notes ? `
                        <div class="detail-row">
                            <div class="detail-label">Notes:</div>
                            <div class="detail-value">${password.notes}</div>
                        </div>
                        ` : ''}
                    </div>
                    ${tagsHtml ? `<div class="password-tags">${tagsHtml}</div>` : ''}
                    <div class="password-actions">
                        <button class="icon-btn view-btn" title="View Password">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="icon-btn copy-btn" title="Copy Password">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="icon-btn edit-btn" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                `;
               
                // Add event listeners to card buttons
                const viewBtn = card.querySelector('.view-btn');
                const copyBtn = card.querySelector('.copy-btn');
                const editBtn = card.querySelector('.edit-btn');
                const checkbox = card.querySelector('.password-checkbox');
               
                // Require master password verification for sensitive operations
                viewBtn.addEventListener('click', () => verifyMasterPassword(() => showUnlockModal(index)));
                copyBtn.addEventListener('click', () => verifyMasterPassword(() => copyPassword(index)));
                editBtn.addEventListener('click', () => verifyMasterPassword(() => editPassword(index)));
                checkbox.addEventListener('change', updateBulkActions);
               
                grid.appendChild(card);
            });
        }

        /**
         * Update filter dropdowns with current tags
         */
        function updateFilters() {
            const tagFilter = document.getElementById('tagFilter');
           
            // Update tag filter dropdown
            const tags = getAllTags();
            tagFilter.innerHTML = '<option value="all">All Tags</option>';
            tags.forEach(tag => {
                tagFilter.innerHTML += `<option value="${tag}">${tag}</option>`;
            });
        }

        /**
         * Update statistics display
         */
        function updateStatistics() {
            const passwords = getSavedPasswords();
            const statsGrid = document.getElementById('passwordStats');
           
            const totalPasswords = passwords.length;
            const tags = getAllTags();
            // Count weak passwords (less than 8 characters)
            const weakPasswords = passwords.filter(pw => {
                return pw.password && pw.password.length < 8;
            }).length;
           
            // Create stat cards HTML
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalPasswords}</div>
                    <div class="stat-label">Total Passwords</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${tags.length}</div>
                    <div class="stat-label">Tags</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${weakPasswords}</div>
                    <div class="stat-label">Weak Passwords</div>
                </div>
            `;
        }

        // ========== SEARCH AND FILTER FUNCTIONS ==========
        /**
         * Filter passwords based on search and tag filters
         */
        function filterPasswords() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const tagFilter = document.getElementById('tagFilter').value;
           
            let passwords = getSavedPasswords();
           
            // Apply search filter across multiple fields
            if (searchTerm) {
                passwords = passwords.filter(pw => {
                    return (
                        (pw.website && pw.website.toLowerCase().includes(searchTerm)) ||
                        (pw.username && pw.username.toLowerCase().includes(searchTerm)) ||
                        (pw.tags && pw.tags.some(tag => tag.toLowerCase().includes(searchTerm))) ||
                        (pw.notes && pw.notes.toLowerCase().includes(searchTerm))
                    );
                });
            }
           
            // Apply tag filter
            if (tagFilter && tagFilter !== 'all') {
                passwords = passwords.filter(pw =>
                    pw.tags && pw.tags.includes(tagFilter)
                );
            }
           
            // Re-render grid with filtered results
            renderPasswordGrid(passwords);
        }

        // ========== BULK OPERATIONS ==========
        /**
         * Get indices of selected password checkboxes
         * @returns {Array} Array of selected indices
         */
        function getSelectedPasswordIndices() {
            const checkboxes = document.querySelectorAll('.password-checkbox:checked');
            return Array.from(checkboxes).map(cb => parseInt(cb.dataset.index));
        }

        /**
         * Select or deselect all passwords
         * @param {boolean} select - True to select all, false to deselect all
         */
        function selectAllPasswords(select) {
            const checkboxes = document.querySelectorAll('.password-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = select;
                // Toggle visual selected state on card
                cb.closest('.password-card').classList.toggle('selected', select);
            });
            updateBulkActions();
        }

        /**
         * Delete selected passwords after confirmation
         */
        function deleteSelectedPasswords() {
            const selectedIndices = getSelectedPasswordIndices();
            if (selectedIndices.length === 0) {
                alert('Please select passwords to delete.');
                return;
            }
           
            // Confirm deletion
            if (!confirm(`Are you sure you want to delete ${selectedIndices.length} password(s)? This action cannot be undone.`)) {
                return;
            }
           
            // Verify master password for security
            const masterPassword = prompt('Enter your master password to confirm deletion:');
            if (masterPassword !== getMasterPassword()) {
                alert('Incorrect password. Deletion cancelled.');
                return;
            }
           
            let passwords = getSavedPasswords();
            // Sort indices in descending order to avoid index shifting issues
            selectedIndices.sort((a, b) => b - a);
            // Remove selected passwords
            selectedIndices.forEach(index => {
                passwords.splice(index, 1);
            });
           
            setSavedPasswords(passwords);
            renderPasswordGrid();
            updateFilters();
            updateStatistics();
            alert(`${selectedIndices.length} password(s) deleted successfully.`);
        }

        /**
         * Update bulk action buttons based on selection count
         */
        function updateBulkActions() {
            const selectedCount = getSelectedPasswordIndices().length;
            const deleteBtn = document.getElementById('deleteSelectedBtn');
           
            // Update button text with count
            deleteBtn.innerHTML = `<i class="fas fa-trash"></i> Delete (${selectedCount})`;
            deleteBtn.disabled = selectedCount === 0; // Disable if none selected
        }

        // ========== MASTER PASSWORD VERIFICATION ==========
        let pendingAction = null; // Store callback for pending action after verification

        /**
         * Show master password verification modal before sensitive action
         * @param {Function} actionCallback - Function to call after successful verification
         */
        function verifyMasterPassword(actionCallback) {
            pendingAction = actionCallback;
            document.getElementById('masterPasswordModal').classList.add('active');
        }

        /**
         * Verify entered master password
         */
        function verifyMasterPasswordInput() {
            const inputPassword = document.getElementById('masterPasswordInput').value;
            const masterPassword = getMasterPassword();
           
            if (inputPassword !== masterPassword) {
                alert('Incorrect password. Please try again.');
                return;
            }
           
            // Close modal and clear input
            document.getElementById('masterPasswordModal').classList.remove('active');
            document.getElementById('masterPasswordInput').value = '';
           
            // Execute pending action if verification successful
            if (pendingAction) {
                pendingAction();
                pendingAction = null;
            }
        }

        // ========== PASSWORD OPERATIONS ==========
        /**
         * Copy password to clipboard
         * @param {number} index - Index of password to copy
         */
        function copyPassword(index) {
            const passwords = getSavedPasswords();
            const password = passwords[index];
           
            if (!password) return;
           
            // Use Clipboard API to copy password
            navigator.clipboard.writeText(password.password)
                .then(() => {
                    const card = document.querySelector(`.password-card[data-index="${index}"]`);
                    const existingBadge = card.querySelector('.copy-badge');
                    if (existingBadge) existingBadge.remove();
                   
                    // Show temporary "Copied!" badge
                    const badge = document.createElement('div');
                    badge.className = 'copy-badge';
                    badge.textContent = 'Copied!';
                    card.appendChild(badge);
                   
                    // Remove badge after 2 seconds
                    setTimeout(() => {
                        if (badge.parentNode) badge.parentNode.removeChild(badge);
                    }, 2000);
                })
                .catch(err => {
                    console.error('Failed to copy:', err);
                    alert('Failed to copy password to clipboard.');
                });
        }

        /**
         * Show unlock modal to view a password
         * @param {number} index - Index of password to view
         */
        function showUnlockModal(index) {
            const modal = document.getElementById('unlockModal');
            modal.dataset.index = index; // Store index in modal
            modal.classList.add('active');
        }

        /**
         * Unlock and view a password after master password verification
         */
        function unlockPassword() {
            const modal = document.getElementById('unlockModal');
            const index = parseInt(modal.dataset.index);
            const inputPassword = document.getElementById('unlockPassword').value;
            const masterPassword = getMasterPassword();
           
            if (inputPassword !== masterPassword) {
                alert('Incorrect password. Please try again.');
                return;
            }
           
            const passwords = getSavedPasswords();
            const password = passwords[index];
           
            if (!password) return;
           
            // Show password in alert (in production, would use more secure method)
            alert(`Password for ${password.website}:\n\n${password.password}\n\nThis password will not be shown again.`);
           
            modal.classList.remove('active');
            document.getElementById('unlockPassword').value = '';
        }

        // ========== MODAL FUNCTIONS ==========
        /**
         * Show add/edit password modal
         * @param {number|null} editIndex - Index to edit, or null for new password
         */
        function showPasswordModal(editIndex = null) {
            const modal = document.getElementById('passwordModal');
            const form = document.getElementById('passwordForm');
            const title = document.getElementById('modalTitle');
            const submitBtn = document.getElementById('modalSubmitBtn');
           
            if (editIndex !== null) {
                // Edit mode
                title.textContent = 'Edit Password';
                submitBtn.textContent = 'Update Password';
               
                const passwords = getSavedPasswords();
                const password = passwords[editIndex];
               
                // Populate form with existing data
                document.getElementById('modalWebsite').value = password.website || '';
                document.getElementById('modalUsername').value = password.username || '';
                document.getElementById('modalPassword').value = password.password || '';
                document.getElementById('modalNotes').value = password.notes || '';
               
                // Load tags into container
                const tagsContainer = document.getElementById('tagsContainer');
                tagsContainer.innerHTML = '';
                if (password.tags && password.tags.length > 0) {
                    password.tags.forEach(tag => {
                        addTagToContainer(tag);
                    });
                }
                addTagInput();
               
                modal.dataset.editIndex = editIndex;
            } else {
                // Add mode
                title.textContent = 'Add New Password';
                submitBtn.textContent = 'Save Password';
               
                form.reset();
                const tagsContainer = document.getElementById('tagsContainer');
                tagsContainer.innerHTML = '';
                addTagInput();
               
                delete modal.dataset.editIndex;
            }
           
            modal.classList.add('active');
        }

        /**
         * Close all modals and reset forms
         */
        function closeModal() {
            document.getElementById('passwordModal').classList.remove('active');
            document.getElementById('unlockModal').classList.remove('active');
            document.getElementById('masterPasswordModal').classList.remove('active');
           
            // Reset all form inputs
            document.getElementById('passwordForm').reset();
            document.getElementById('unlockForm').reset();
            document.getElementById('masterPasswordForm').reset();
            document.getElementById('unlockPassword').value = '';
            document.getElementById('masterPasswordInput').value = '';
        }

        /**
         * Save or update a password
         * @param {Event} event - Form submit event
         */
        function savePassword(event) {
            event.preventDefault();
           
            // Get form values
            const website = document.getElementById('modalWebsite').value.trim();
            const username = document.getElementById('modalUsername').value.trim();
            const password = document.getElementById('modalPassword').value.trim();
            const notes = document.getElementById('modalNotes').value.trim();
           
            // Get tags from container
            const tagElements = document.querySelectorAll('.tag-item .tag-text');
            const tags = Array.from(tagElements).map(el => el.textContent.trim());
           
            // Validate required fields
            if (!website || !username || !password) {
                alert('Please fill in all required fields.');
                return;
            }
           
            // Verify master password before saving
            const masterPassword = prompt('Enter your master password to save this password:');
            if (masterPassword !== getMasterPassword()) {
                alert('Incorrect password. Save cancelled.');
                return;
            }
           
            const modal = document.getElementById('passwordModal');
            const editIndex = modal.dataset.editIndex;
            let passwords = getSavedPasswords();
           
            // Create password object
            const passwordData = {
                website,
                username,
                password,
                tags: tags.length > 0 ? tags : null,
                notes: notes || null,
                createdAt: editIndex !== undefined ? passwords[editIndex].createdAt : Date.now(),
                updatedAt: Date.now()
            };
           
            if (editIndex !== undefined) {
                // Update existing password
                passwords[editIndex] = passwordData;
            } else {
                // Add new password
                passwords.push(passwordData);
            }
           
            setSavedPasswords(passwords);
            closeModal();
            renderPasswordGrid();
            updateFilters();
            updateStatistics();
           
            alert(`Password ${editIndex !== undefined ? 'updated' : 'saved'} successfully!`);
        }

        /**
         * Edit a specific password
         * @param {number} index - Index of password to edit
         */
        function editPassword(index) {
            showPasswordModal(index);
        }

        // ========== TAG INPUT HANDLING ==========
        /**
         * Add a tag to the tags container
         * @param {string} tagText - Tag text to add
         */
        function addTagToContainer(tagText) {
            const container = document.getElementById('tagsContainer');
            const tagItem = document.createElement('div');
            tagItem.className = 'tag-item';
            tagItem.innerHTML = `
                <span class="tag-text">${tagText}</span>
                <button type="button" class="tag-remove">&times;</button>
            `;
           
            // Add remove functionality
            tagItem.querySelector('.tag-remove').addEventListener('click', () => {
                tagItem.remove();
            });
           
            // Insert before the input field
            container.insertBefore(tagItem, container.querySelector('.tags-input'));
        }

        /**
         * Add tag input field to container
         */
        function addTagInput() {
            const container = document.getElementById('tagsContainer');
            let input = container.querySelector('.tags-input');
           
            // Create input if it doesn't exist
            if (!input) {
                input = document.createElement('input');
                input.type = 'text';
                input.className = 'tags-input';
                input.placeholder = 'Type tags and press Enter...';
                container.appendChild(input);
            }
           
            // Handle Enter key and comma for adding tags
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    const tagText = this.value.trim();
                    if (tagText) {
                        addTagToContainer(tagText);
                        this.value = ''; // Clear input
                    }
                }
            });
           
            // Handle blur (focus loss) - add tag if text exists
            input.addEventListener('blur', function() {
                const tagText = this.value.trim();
                if (tagText) {
                    addTagToContainer(tagText);
                    this.value = '';
                }
            });
        }

        // ========== DOWNLOAD FUNCTIONALITY ==========
        /**
         * Download all passwords as JSON file
         */
        function downloadAllPasswords() {
            const passwords = getSavedPasswords();
            if (passwords.length === 0) {
                alert('No passwords to download.');
                return;
            }
           
            // Verify master password for security
            const masterPassword = prompt('Enter your master password to download passwords:');
            if (masterPassword !== getMasterPassword()) {
                alert('Incorrect password. Download cancelled.');
                return;
            }
           
            // Create JSON string
            const dataStr = JSON.stringify(passwords, null, 2); // Pretty print with 2-space indentation
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
           
            // Create filename with current date
            const exportFileDefaultName = `keysafe-passwords-${new Date().toISOString().split('T')[0]}.json`;
           
            // Create temporary link element for download
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
           
            alert(`${passwords.length} passwords downloaded successfully.`);
        }

        // ========== EVENT LISTENERS ==========
        document.addEventListener('DOMContentLoaded', function() {
            // ========== INITIALIZATION ==========
            // Check if user is logged in
            const loggedInUser = getLoggedInUser();
            if (!loggedInUser) {
                window.location.href = "login_signup.html";
                return;
            }
           
            console.log("User logged in:", loggedInUser.username);
            console.log("Remember me:", loggedInUser.rememberMe);
           
            // Initialize page components
            updateSessionTimer();
            setInterval(updateSessionTimer, 1000); // Update timer every second
           
            renderPasswordGrid();
            updateFilters();
            updateStatistics();
           
            // ========== SEARCH AND FILTER EVENT LISTENERS ==========
            document.getElementById('searchInput').addEventListener('input', filterPasswords);
            document.getElementById('tagFilter').addEventListener('change', filterPasswords);
           
            // ========== BULK ACTION BUTTONS ==========
            document.getElementById('addPasswordBtn').addEventListener('click', () => showPasswordModal());
            document.getElementById('selectAllBtn').addEventListener('click', () => {
                const allSelected = getSelectedPasswordIndices().length > 0;
                selectAllPasswords(!allSelected); // Toggle select/deselect all
            });
            document.getElementById('deleteSelectedBtn').addEventListener('click', deleteSelectedPasswords);
            document.getElementById('downloadAllBtn').addEventListener('click', downloadAllPasswords);
           
            // ========== MODAL CONTROLS ==========
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('modalCancelBtn').addEventListener('click', closeModal);
            document.getElementById('passwordForm').addEventListener('submit', savePassword);
           
            document.getElementById('closeUnlockModal').addEventListener('click', closeModal);
            document.getElementById('cancelUnlockBtn').addEventListener('click', closeModal);
            document.getElementById('unlockForm').addEventListener('submit', function(e) {
                e.preventDefault();
                unlockPassword();
            });
           
            document.getElementById('closeMasterPasswordModal').addEventListener('click', closeModal);
            document.getElementById('cancelMasterPasswordBtn').addEventListener('click', closeModal);
            document.getElementById('masterPasswordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                verifyMasterPasswordInput();
            });
           
            // Close modals when clicking outside modal card
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) { // Clicked on overlay, not card
                        closeModal();
                    }
                });
            });
           
            // ========== MENU FUNCTIONALITY ==========
            const menuBtn = document.getElementById("barMenuBtn");
            const menuOverlay = document.getElementById("menuOverlay");
            const menuBars = document.getElementById("menuBars");
            const menuX = document.getElementById("menuX");
            let menuOpen = false;
            let menuCloseTimeout = null;
           
            // Open menu
            menuBtn.onclick = function(e) {
                e.stopPropagation(); // Prevent event bubbling
                if (!menuOpen) {
                    menuOverlay.classList.add("active");
                    menuOverlay.classList.remove("closing");
                    menuBars.style.display = "none"; // Hide hamburger bars
                    menuOpen = true;
                    menuBtn.style.transform = "scale(0.9)";
                    setTimeout(() => {
                        menuBtn.style.transform = "scale(1)";
                    }, 150);
                }
            };
           
            // Close menu
            menuX.onclick = function(e) {
                e.stopPropagation();
                if (menuOpen) {
                    menuOverlay.classList.remove("active");
                    menuOverlay.classList.add("closing");
                    menuBars.style.display = "flex"; // Show hamburger bars
                    menuOpen = false;
                    menuX.style.transform = "scale(0.9)";
                    setTimeout(() => {
                        menuX.style.transform = "scale(1)";
                    }, 150);
                   
                    clearTimeout(menuCloseTimeout);
                    // Remove closing class after animation completes
                    menuCloseTimeout = setTimeout(() => {
                        menuOverlay.classList.remove("closing");
                    }, 350);
                }
            };
           
            // Close menu when clicking on overlay background
            menuOverlay.onclick = function(e) {
                if(e.target === menuOverlay && menuOpen) {
                    menuX.onclick(e);
                }
            };
           
            /**
             * Close the menu
             */
            function closeMenu() {
                if (menuOpen) {
                    menuX.onclick(new Event("click"));
                }
            }
           
            // ========== MENU NAVIGATION ==========
            // Home page
            document.getElementById("menuHome").onclick = function() {
                closeMenu();
                window.location.href = "index.html";
            };
           
            // Password maker page
            document.getElementById("menuPasswordMaker").onclick = function() {
                closeMenu();
                window.location.href = "password_maker.html";
            };
           
            // Password checker page
            document.getElementById("menuPasswordChecker").onclick = function() {
                closeMenu();
                window.location.href = "password_checker.html";
            };
           
            // Saved passwords page (current page)
            document.getElementById("menuSavedPasswords").onclick = function() {
                closeMenu();
                window.location.href = "password_saved.html";
            };
           
            // FAQ page
            document.getElementById("menuFAQ").onclick = function() {
                closeMenu();
                window.location.href = "faq.html";
            };
           
            // About page (opens in new tab)
            document.getElementById("menuAbout").onclick = function() {
                closeMenu();
                window.open("https://kingfarooq.github.io", "_blank");
            };
           
            // Logout
            document.getElementById("menuLogout").onclick = function() {
                clearLoggedInUser();
                window.location.href = "login_signup.html";
            };
        });
    </script>
</body>
</html>
